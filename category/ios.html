<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>West's blog - iOS</title>

    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/style.css" />
    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/pygments.css" />	
    <script src="http://szuwest.github.io/theme/js/custom.modernizr.js"></script>

    <!-- So Firefox can bookmark->"abo this site" -->

</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://szuwest.github.io">West's blog</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
        
        

            <article>
                <a href="http://szuwest.github.io/sheng-ji-xcode8hou-jenkinsda-bao-wen-ti.html"><h3 class="article-title">升级Xcode8后Jenkins打包问题</h3></a>
<h6 class="subheader" title="2016-09-29T00:00:00">2016-09-29
</h6>


<h2>升级Xcode8后Jenkins打包问题</h2>
<p>上次说升级Xcode8之后，Jenkins自动打包就不行了，今天终于弄好了。前前后后话的时间有一天的时间才搞好，不容易。尝试了30多次才成功了，说多了都是泪。。现在记录一下。</p>
<h3>我们的需求</h3>
<p>说一下我们的需求。我们开发人员采用的是正式签名，正式的BundleID，但是我们Jenkins自动打包出来的是企业版，用的是企业版BundleID。代码是同一份，但是Jenkins打包企业版时时要先修改BundleID和相关版本号之类的。在Xcode7时代，我已经将Jenkins配置好，可以正常打出企业版的安装包。但是升级到Xcode8之后，Jenkins打包会报错，即原来的配置已经不能打出企业包来了。</p>
<h3>解决方法</h3>
<p>先说不能打包的原因，主要是签名方式冲突。Jenkins的配置是指定签名，而我们Xcode8采用的是自动签名。我们开发时采用自动签名，而且打企业版安装采用的签名文件跟我们开发时的签名文件时不一样的。所以Jenkins打包肯定得采用手动签名方式。</p>
<p>报错如下：</p>
<div class="highlight"><pre><span class="n">xxxxx</span> <span class="n">has</span> <span class="n">conflicting</span> <span class="n">provisioning</span> <span class="n">settings</span><span class="p">.</span> <span class="n">xxxxx</span> <span class="n">is</span> <span class="n">automatically</span> <span class="kt">signed</span><span class="p">,</span> <span class="n">but</span> <span class="n">code</span> <span class="n">signing</span> <span class="n">identity</span> <span class="n">xxxxxxxxxxxxx</span> <span class="n">has</span> <span class="n">been</span> <span class="n">manually</span> <span class="n">specified</span><span class="p">.</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">code</span> <span class="n">signing</span> <span class="n">identity</span> <span class="n">value</span> <span class="n">to</span> <span class="s">&quot;iPhone Developer&quot;</span> <span class="n">in</span> <span class="n">the</span> <span class="n">build</span> <span class="n">settings</span> <span class="n">editor</span><span class="p">,</span> <span class="n">or</span> <span class="k">switch</span> <span class="n">to</span> <span class="n">manual</span> <span class="n">signing</span> <span class="n">in</span> <span class="n">the</span> <span class="n">project</span> <span class="n">editor</span><span class="p">.</span>
</pre></div>


<p>所以解决方法也很直接，就是不采用自动签名。可是我找遍了国内外网上资料，没有人提供 自动关闭 自动签名 的方法。倒是有人在苹果的网站上提问如何关闭自动签名。我在国内一些网站上也有一些人提到这个问题，其中有人用 bashsell 的sed 文本替换命令来修改project.pbxproj里面的内容。</p>
<p>总之我的方向就是关闭自动打包，修改一些配置，然后让它可以打包。说起来简单，自动签名方式怎么关闭，需要改哪些配置，我不知道，只能摸索和不断的尝试。</p>
<p>一开始我尝试按照网上的一个列子来关闭自动签名方式。它是采用 sed 命令。由于我本身对bash shell 也不是很熟悉，试了好多次都没有成功。而且到后面我发现要关闭自动签名，只将 ProvisioningStyle 改为 Manual是不够的。我自己手动的去关闭和开启自动签名，看看project.pbxproj到底哪些参数改变了，然后采用我比较熟悉的PlistBuddy命令，写了个脚本去改变这些值，来达到关闭自动签名的效果。</p>
<p>最终我写出来的脚本大概是这样的：</p>
<div class="highlight"><pre>#修改ProvisioningStyle 
/usr/libexec/PlistBuddy -c “Set :objects:574F440C1AEE5EA3003F9BB5:attributes:TargetAttributes:574F44131AEE5EA3003F9BB5:ProvisioningStyle Manual”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj

#修改Distribution签名配置
/usr/libexec/PlistBuddy -c “Set :objects:2B888A201AFB4C3F005E1E12:buildSettings:CODE_SIGN_IDENTITY[sdk=iphoneos*] ‘xxxxxxxxxxxxxx’”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj

/usr/libexec/PlistBuddy -c “Set :objects:574F443B1AEE5EA4003F9BB5:buildSettings:PROVISIONING_PROFILE  &#39;xxxxxxxxxxxx&#39;”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj

/usr/libexec/PlistBuddy -c “Set :objects:574F443B1AEE5EA4003F9BB5:buildSettings:PROVISIONING_PROFILE_SPECIFIER xxxxxxxxxxxx”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj

#修改Debug签名配置
/usr/libexec/PlistBuddy -c “Set :objects:574F443B1AEE5EA4003F9BB5:buildSettings:CODE_SIGN_IDENTITY[sdk=iphoneos*] ‘iPhone Distribution’”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj

/usr/libexec/PlistBuddy -c “Set :objects:574F443B1AEE5EA4003F9BB5:buildSettings:PROVISIONING_PROFILE  &#39;xxxxxxxxxxxx&#39;”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj

/usr/libexec/PlistBuddy -c “Set :objects:574F443B1AEE5EA4003F9BB5:buildSettings:PROVISIONING_PROFILE_SPECIFIER xxxxxxxxxxxx”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj

#修改Release签名配置
/usr/libexec/PlistBuddy -c “Set :objects:2B888A201AFB4C3F005E1E12:buildSettings:CODE_SIGN_IDENTITY[sdk=iphoneos*] ‘iPhone Distribution’”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj

/usr/libexec/PlistBuddy -c “Set :objects:574F443B1AEE5EA4003F9BB5:buildSettings:PROVISIONING_PROFILE  &#39;xxxxxxxxxxxx&#39;”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj

/usr/libexec/PlistBuddy -c “Set :objects:574F443B1AEE5EA4003F9BB5:buildSettings:PROVISIONING_PROFILE_SPECIFIER xxxxxxxxxxxx”  <span class="cp">${</span><span class="n">WORKSPACE</span><span class="cp">}</span>/xxxxx/xxxxx.xcodeproj/project.pbxproj
</pre></div>


<p>归纳起来，就是先将签名方式ProvisioningStyle改为手动的，然后将Distribution，Debug, Release 相关的CODE_SIGN_IDENTITY[sdk=iphoneos*]，buildSettings:PROVISIONING_PROFILE，PROVISIONING_PROFILE_SPECIFIER的值做对应的修改。另外BundleID和develop team我没有用PlistBuddy来修改，而是通过在Jenkins的配置<strong>Custom xcodebuild arguments</strong> 加入参数 <code>DEVELOPMENT_TEAM=DLF3GQKP4Q PRODUCT_BUNDLE_IDENTIFIER=xxxxxxxxx</code> 来指定。这样编译器会自动修改相关值</p>
<p>配置完这些，ipa包是能打出来了，但是却最后失败了，报错是签名问题，还有找不到ResourceRules.plist。</p>
<p>最终我发现只要 把Jenkins配置中的把 Sign IPA at build time 的勾选去掉，然后打包就没有问题了。然后我也把在Jenkins的配置<strong>Custom xcodebuild arguments</strong> 参数中，原来有的参数 <code>CODE_SIGN_RESOURCE_RULES_PATH=$(SDKROOT)/ResourceRules.plist</code> 去掉，打出来的安装包也没有问题。当时这个参数在Xcode7是必填的，现在Xcode8却可以去掉了。</p>
<p>以上就是我被Xcode8折腾经验总结。</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ios.html">iOS</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/jenkins-xcode8-ios10.html">Jenkins Xcode8 iOS10 </a>
</p>



<p><a href="http://szuwest.github.io/sheng-ji-xcode8hou-jenkinsda-bao-wen-ti.html#disqus_thread">comments</a></p>            </article>


                <hr  class="gradient"/>


        


            <article>
                <a href="http://szuwest.github.io/sheng-ji-xcode8hou-xu-yao-zhu-yi-de-shi-xiang.html"><h3 class="article-title">升级Xcode8后需要注意的事项</h3></a>
<h6 class="subheader" title="2016-09-24T00:00:00">2016-09-24
</h6>


<h2>升级Xcode8后需要注意的事项</h2>
<p>随着iPhone7开卖适配iOS10成了必不可少的事情。要适配iOS10，升级Xcode8又是必须的事情。可以一旦升级Xcode8之后会发现一堆坑在里面。每次升级Xcode或者iOS系统或者Mac系统都是有一堆的坑，每次都要折腾得你死去活来不罢休。这有点像飞蛾扑火，明明知道前面是火坑，也要往下跳。</p>
<h3>升级第一坑，注释代码快捷键失效</h3>
<p>当你经过漫长的等待Xcode下载和安装之后，满心欢喜打开Xcode，发现字体变了，貌似看上去还不错（有同事跟我说这很丑），然后开始写代码，发现可以高亮显示当前编辑行，不错嘛，写着写着突然想注释掉一行代码，发现command+/怎么按都没反应，十分恼火。这什么破玩意儿，这么明显的bug都有。然后网上搜解决方案，确实有人也遇到这个问题。貌似需要跑一个命令什么的。实际上不用那么费劲，重启一下Xcode就好了。</p>
<h3>升级第二坑，iOS的字体变宽了</h3>
<p>当我Run一下程序想看看我们的程序在iOS10上有没有问题，启动之后打开引导页，发现最底下的两个按钮字显示不全了：注册账号 变成了 注···号，登录账号变成了 登···号，这是什么鬼？我没有动过这块的任何代码，甚至连这个页面的xib也没有打开过。后来才知道，运来是iOS的字体变宽了，如果你一个按钮在iOS9原来刚好放下4个字，然后iOS10它就装不下了 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ios.html">iOS</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/jenkins-xcode8-ios10.html">Jenkins Xcode8 iOS10 </a>
</p>



<p><a href="http://szuwest.github.io/sheng-ji-xcode8hou-xu-yao-zhu-yi-de-shi-xiang.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/sheng-ji-xcode8hou-xu-yao-zhu-yi-de-shi-xiang.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/iosxi-tong-xiang-ce-shang-chuan-bu-de-bu-shuo-de-na-xie-shi-er.html"><h3 class="article-title">iOS系统相册上传不得不说的那些事儿</h3></a>
<h6 class="subheader" title="2016-05-02T00:00:00">2016-05-02
</h6>


<p>最近在开发手机相册自动备份的功能，这就需要用到上传文件的功能。
其实我一年前也做过同样的功能，当时也做得不算很好。这次是别人做了，然后那人离职了。我来接受这块，然后发现有问题，然后准备认真的研究一下这个问题，顺便学习更多的iOS开发的知识。</p>
<h2>系统相册概述</h2>
<p>首先说一下iOS相册的问题。iOS的相片都是存放在系统库ALAssetLibrary中，开发者从这个库中读取到的是一个个ALAsset对象，而不是一个文件系统的File文件。当然iOS8系统新增了Photo Framework,但是只是增强了相关功能，还是不能直接取到File。 这个Android平台或者PC平台很不一样的。</p>
<p>我们知道一般的上传文件流程就是，将本地的文件转换为二进制数据或流，通过HTTP协议或者socket协议，本地和服务器之间建立一个连接，本地将流写入这个连接，服务器那边接收这个流，并将接收到的流写入文件，直接客户端那边将整个文件传完，传输就结束了。上传文件这个过程一般会被封装库，使用者只需传入必要的参数就可以了。我以前做自动备份相册的时候，就是使用了别人提供的静态库，它上传文件API就是需要传一个文件的本地路径。这就麻烦了，因为我们的应用从iOS系统库读取到的对象是ALAsset, 所以我需要先将ALAsset从系统中导出，写入我们应用的沙盒中，然后再把它在沙盒中路径传给上传库进行上传。</p>
<h2>导出ALAsset</h2>
<p>据我所知，iOS系统cocoa层网络传输基本上只有<strong>NSURLConnection</strong>和基于<strong>NSURLSession</strong>一套API。它们提供的接口基本上都是基于NSData，或者文件路径或者NSInputStream。网上有很多库或者框架都是基于这两套API来做上传，我们一般也使用第三方的框架来减少工作量 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ios.html">iOS</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/ioswang-luo-bian-cheng-xi-tong-xiang-ce-shang-chuan-dao-chu-shi-pin-nsurlconnection-nsurlsession-da-wen-jian-shang-chuan-hou-tai-shang-chuan.html">iOS网络编程 系统相册上传 导出视频 NSURLConnection NSURLSession 大文件上传 后台上传 </a>
</p>



<p><a href="http://szuwest.github.io/iosxi-tong-xiang-ce-shang-chuan-bu-de-bu-shuo-de-na-xie-shi-er.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/iosxi-tong-xiang-ce-shang-chuan-bu-de-bu-shuo-de-na-xie-shi-er.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/swiftchu-tan.html"><h3 class="article-title">swift初探</h3></a>
<h6 class="subheader" title="2014-06-22T00:00:00">2014-06-22
</h6>


<h1>swift初探</h1>
<p>自从swift公布以来，火得不得了。如果你是开发者，还没有看过swift，那还真是out了（不过话说回来，并不是没有看过swift就不是好开发者。好的程序员跟看没看过某种语言没有什么关系）。我从公布以来就断断续续的看，一直在看官方的英文文档。偶尔也看看别人写的或者翻译的文章。现在虽然没有把官方文档看完，但是也看了大部分，可以写写感想心得。</p>
<p>简单来说，swift是集合了许多脚本语言的特性而又不像其他一般的脚本语言的苹果新生代开发语言。swift集合了很多语言的特性，如ruby，object-c，c++，c#等，其中长得最像的应该是ruby。咋看之下swift就想ruby一样的脚本语言。完全面向对象，类型定义，closure特性，函数式编程等等。不过据官方文档介绍，swift语言不是解释型语言，它最终会编译成二进制代码，并且它的运行效率比object-c要快。说比object-C要快我是比较怀疑的，而外国开发者进行了测试，得出结论是如果不强加一些编译优化的话，是快不过objC的。</p>
<p>如果对ruby，Object-C，c++语言熟悉的话，学起swift来应该没有什么难度。但是它还有很多语法特性是别的语言没有的，并且有些在我看来有点奇怪的特性。不过这是都没有什么，说明自己见识少，熟悉了就好了。首先一个比较特别的是，你不在需要在每行代码结束时加上分号，直接回车换行就行 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ios.html">iOS</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/swift.html">swift </a>
</p>



<p><a href="http://szuwest.github.io/swiftchu-tan.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/swiftchu-tan.html">Read More</a>
                <hr  class="gradient"/>
            </article>

            <!-- /#posts-list -->
<div class="pagination-centered">
<h6 class="subheader">Page 1 of 1</h6>

<p>

</p>
</div>

    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://szuwest.github.io/archives.html">Archives</a>
            <li><a href="http://szuwest.github.io/tags.html">Tags</a>


        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://szuwest.github.io/category/android.html">Android</a></li>
            <li><a href="http://szuwest.github.io/category/bian-cheng-jia-gou.html">编程架构</a></li>
            <li><a href="http://szuwest.github.io/category/ios.html">iOS</a></li>
            <li><a href="http://szuwest.github.io/category/ji-zhu-xin-de.html">技术心得</a></li>
            <li><a href="http://szuwest.github.io/category/ji-zhu-za-tan.html">技术杂谈</a></li>
            <li><a href="http://szuwest.github.io/category/sheng-huo.html">生活</a></li>
            <li><a href="http://szuwest.github.io/category/suan-fa.html">算法</a></li>
            <li><a href="http://szuwest.github.io/category/test.html">Test</a></li>
   
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://szuwest.github.io/pages/about.html">About</a></li>
            <li><a href="http://szhanfeng203.blog.163.com/">我的生活博客</a></li>
            <li><a href="http://szuwest.github.io/feeds/all.atom.xml">RSS</a></li>
        </ul>
		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/szuwest">Github</a></li>
            <li><a href="https://twitter.com/szuwest">Twitter</a></li>
            <li><a href="https://www.facebook.com/profile.php?id=1084651913">Facebook</a></li>
            <li><a href="http://weibo.com/szuwest">微博</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>West's blog by West</p>
            </div>
            </div>
    </div>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-55687145-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</footer>