<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>West's blog - West</title>

    <link rel="stylesheet" href="../theme/css/normalize.css" />
    <link rel="stylesheet" href="../theme/css/foundation.min.css" />
    <link rel="stylesheet" href="../theme/css/style.css" />
    <link rel="stylesheet" href="../theme/css/pygments.css" />	
    <script src="../theme/js/custom.modernizr.js"></script>

    <!-- So Firefox can bookmark->"abo this site" -->

</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="..">West's blog</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
        
        

            <article>
                <a href="../activitydong-hua-er.html"><h3 class="article-title">Activity动画（二）</h3></a>
<h6 class="subheader" title="2014-11-12T00:00:00">2014-11-12
</h6>


<h1>Activity动画（二）</h1>
<p>如果要统一所有的Activity的打开可关闭动画，可以有一个很简便的方法：就是设置Application的theme。在Application的theme里有一个Android:windowAnimationStyle的属性，可以定义了一个Activity的打开和关闭动画。例如下面的例子就自定义了一个theme。</p>
<hr />
<p>````
<style name="ThemeLightNoTitle" mce_bogus="1" parent="@android:style/Theme.Light.NoTitleBar">
        <item name="android:windowAnimationStyle">@style/AnimationActivity</item>
    </style></p>
<div class="highlight"><pre><span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">&quot;AnimationActivity&quot;</span> <span class="na">mce_bogus=</span><span class="s">&quot;1&quot;</span> <span class="na">parent=</span><span class="s">&quot;@android:style/Animation.Activity&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:activityOpenEnterAnimation&quot;</span><span class="nt">&gt;</span>@anim/translate_between_interface_right_in<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:activityOpenExitAnimation&quot;</span><span class="nt">&gt;</span>@anim/translate_between_interface_left_out<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:activityCloseEnterAnimation&quot;</span><span class="nt">&gt;</span>@anim/translate_between_interface_left_in<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:activityCloseExitAnimation&quot;</span><span class="nt">&gt;</span>@anim/translate_between_interface_right_out<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:taskOpenEnterAnimation&quot;</span><span class="nt">&gt;</span>@anim/translate_between_interface_right_in<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:taskOpenExitAnimation&quot;</span><span class="nt">&gt;</span>@anim/translate_between_interface_left_out<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:taskCloseEnterAnimation&quot;</span><span class="nt">&gt;</span>@anim/translate_between_interface_left_in<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:taskCloseExitAnimation&quot;</span><span class="nt">&gt;</span>@anim/translate_between_interface_right_out<span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/style&gt;</span>
</pre></div>


<p>````</p>
<p>将这个theme运用到Application的theme里，所以的Activity就会按照你定义的动画来交互了。</p>
<p>不过，现实的需求往往是更复杂的动画或者交互，不可能所有的界面的交互动画都一致的。有些页面需要特别定制，而且可能很复杂。例如我们要实现类似于iOS的NavigationViewController的页面右滑关闭页面的交互动画，或者要实现点击一张图片缩略图，然后它渐渐放大，点击关闭它又慢慢缩回原处的动画，按照之前介绍的方法，都无法实现。</p>
<hr />
<p>在iOS自带相册APP里，点击一个缩略图，缩略图渐渐放大进入大图查看。这个交互基本成了一个相册必备的标准交互。Android上的相册很多也用了这种动画交互。如果缩略图的查看和大图查看都是在同一个Activity中完成的话，还是可以比较容易实现的。但是如果缩略的查看和大图的查看分处在不同的Activity中的话，那这就不是很好实现了。这里我准备讲讲可以怎么实现这个功能。而且这个方法可以推广出去，很多类型的Activity切换动画都可以按照这种方式实现。</p>
<p>现在假设查看缩略图的Activity是A，查看大图的Activity是B。</p>
<blockquote>
<ul>
<li>一 设置B的的theme为透明的transparent。</li>
<li>二 在A中，启动B前，把一些必要的信息打包成Bundle传给B，启动B后把默认的启动动画覆盖,overridePendingTransition(0, 0)。例如把被点击的ImageView的在屏幕中的坐标，还有该ImageView的width和height，还有该ImageView所显示的图片资源id，或者URL，都存入Bundle中，讲该Bundle放入Intent中，启动B时传给B。</li>
<li>三 在B的onCreate方法中，把Bundle中的信息取出来，并且对你想要做动画的ImageView中，获取ViewTreeObserver实例，加入一个OnPreDrawListener，在OnPreDrawListener的onPreDraw方法中，对ImageView做放大动画，初始位置就是从Bundle中获取，最终位置根据要显示的图片的大小来定。</li>
<li>四 关闭B Activity时，对ImageView做一个缩小的动画，初始位置就是它现在的位置，最终位置是最开始从Bundle中获取的那个位置。覆盖Activity的finish方法，同样要将Activity的默认动画覆盖掉overridePendingTransition(0, 0)。</li>
</ul>
</blockquote>
<p>我们看一下具体怎么实现，有什么要注意的。</p>
<blockquote>
<p>一· 设置B的的theme为透明的transparent</p>
</blockquote>
<div class="highlight"><pre><span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">&quot;Transparent&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:windowNoTitle&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:windowIsTranslucent&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:windowBackground&quot;</span><span class="nt">&gt;</span>@android:color/transparent<span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">&quot;com.example.android.activityanim.PictureDetailsActivity&quot;</span>
            <span class="na">android:label=</span><span class="s">&quot;@string/subactivity_name&quot;</span>
            <span class="na">android:theme=</span><span class="s">&quot;@style/Transparent&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/activity&gt;</span>
</pre></div>


<p>这里主要是将B Activity的window和它的背景设置成透明的。所有的Activity都有一个默认的样式，默认样式不是透明的。设置成透明的话，在启动B Activity时它的背景是透明的，并且调用overridePendingTransition(0, 0)覆盖掉默认动画，你不会觉察到已经从A进入到B界面。</p>
<blockquote>
<ul>
<li>二. 在A中，启动B前，把一些必要的信息打包成Bundle传给B，启动B后把默认的启动动画覆盖,overridePendingTransition(0, 0)。</li>
</ul>
</blockquote>
<div class="highlight"><pre><span class="c1">// Interesting data to pass across are the thumbnail size/location, the</span>
        <span class="c1">// resourceId of the source bitmap, the picture description, and the</span>
        <span class="c1">// orientation (to avoid returning back to an obsolete configuration if</span>
        <span class="c1">// the device rotates again in the meantime)</span>
        <span class="k">int</span><span class="p">[]</span> <span class="n">screenLocation</span> <span class="o">=</span> <span class="k">new</span> <span class="k">int</span><span class="p">[</span><span class="mh">2</span><span class="p">];</span>
        <span class="n">v</span><span class="p">.</span><span class="n">getLocationOnScreen</span><span class="p">(</span><span class="n">screenLocation</span><span class="p">);</span>
        <span class="n">PictureData</span> <span class="n">info</span> <span class="o">=</span> <span class="n">mPicturesData</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
        <span class="n">Intent</span> <span class="n">subActivity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="p">(</span><span class="n">ActivityAnimations</span><span class="p">.</span><span class="k">this</span><span class="p">,</span>
                <span class="n">PictureDetailsActivity</span><span class="p">.</span><span class="k">class</span><span class="p">);</span>
        <span class="k">int</span> <span class="n">orientation</span> <span class="o">=</span> <span class="n">getResources</span><span class="p">().</span><span class="n">getConfiguration</span><span class="p">().</span><span class="n">orientation</span><span class="p">;</span>
        <span class="n">subActivity</span><span class="p">.</span>
                <span class="n">putExtra</span><span class="p">(</span><span class="no">PACKAGE</span> <span class="o">+</span> <span class="s">&quot;.orientation&quot;</span><span class="p">,</span> <span class="n">orientation</span><span class="p">).</span>
                <span class="n">putExtra</span><span class="p">(</span><span class="no">PACKAGE</span> <span class="o">+</span> <span class="s">&quot;.resourceId&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">resourceId</span><span class="p">).</span>
                <span class="n">putExtra</span><span class="p">(</span><span class="no">PACKAGE</span> <span class="o">+</span> <span class="s">&quot;.left&quot;</span><span class="p">,</span> <span class="n">screenLocation</span><span class="p">[</span><span class="mh">0</span><span class="p">]).</span>
                <span class="n">putExtra</span><span class="p">(</span><span class="no">PACKAGE</span> <span class="o">+</span> <span class="s">&quot;.top&quot;</span><span class="p">,</span> <span class="n">screenLocation</span><span class="p">[</span><span class="mh">1</span><span class="p">]).</span>
                <span class="n">putExtra</span><span class="p">(</span><span class="no">PACKAGE</span> <span class="o">+</span> <span class="s">&quot;.width&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">getWidth</span><span class="p">()).</span>
                <span class="n">putExtra</span><span class="p">(</span><span class="no">PACKAGE</span> <span class="o">+</span> <span class="s">&quot;.height&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">getHeight</span><span class="p">()).</span>

        <span class="n">startActivity</span><span class="p">(</span><span class="n">subActivity</span><span class="p">);</span>

        <span class="c1">// Override transitions: we don&#39;t want the normal window animation in addition</span>
        <span class="c1">// to our custom one</span>
        <span class="n">overridePendingTransition</span><span class="p">(</span><span class="mh">0</span><span class="p">,</span> <span class="mh">0</span><span class="p">);</span>
</pre></div>


<p>这里有个关键点，获取被点击的View的在屏幕上的位置是通过getLocationOnScreen()方法。这个位置在B中很重要。另外还有宽高也是必须信息，被点击的图片resId或者URL等其他信息。</p>
<blockquote>
<p>二. 在B的onCreate方法中，把Bundle中的信息取出来，并且对你想要做动画的ImageView中，获取ViewTreeObserver实例，加入一个OnPreDrawListener，在OnPreDrawListener的onPreDraw方法中，对ImageView做放大动画，初始位置就是从Bundle中获取，最终位置根据要显示的图片的大小来定。</p>
</blockquote>
<p>因为第一步，在用户觉察不到的情况下已进入Activity B,接下来只要在B的视图出现的时候，以一个缩略图放大的动画效果出现就行了。用户看到的效果是点击了A的一个缩略图，缩略图逐渐放大的过程，用户很容易认为这是在A中完成的，实际上这所有的动画都是在B中完成的。看看B中相关的代码:</p>
<div class="highlight"><pre><span class="c1">// Retrieve the data we need for the picture/description to display and</span>
    <span class="c1">// the thumbnail to animate it from</span>
    <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="n">getIntent</span><span class="p">().</span><span class="n">getExtras</span><span class="p">();</span>
    <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">BitmapUtils</span><span class="p">.</span><span class="n">getBitmap</span><span class="p">(</span><span class="n">getResources</span><span class="p">(),</span>
            <span class="n">bundle</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="no">PACKAGE_NAME</span> <span class="o">+</span> <span class="s">&quot;.resourceId&quot;</span><span class="p">));</span>
    <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="n">getString</span><span class="p">(</span><span class="no">PACKAGE_NAME</span> <span class="o">+</span> <span class="s">&quot;.description&quot;</span><span class="p">);</span>
    <span class="k">final</span> <span class="k">int</span> <span class="n">thumbnailTop</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="no">PACKAGE_NAME</span> <span class="o">+</span> <span class="s">&quot;.top&quot;</span><span class="p">);</span>
    <span class="k">final</span> <span class="k">int</span> <span class="n">thumbnailLeft</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="no">PACKAGE_NAME</span> <span class="o">+</span> <span class="s">&quot;.left&quot;</span><span class="p">);</span>
    <span class="k">final</span> <span class="k">int</span> <span class="n">thumbnailWidth</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="no">PACKAGE_NAME</span> <span class="o">+</span> <span class="s">&quot;.width&quot;</span><span class="p">);</span>
    <span class="k">final</span> <span class="k">int</span> <span class="n">thumbnailHeight</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="no">PACKAGE_NAME</span> <span class="o">+</span> <span class="s">&quot;.height&quot;</span><span class="p">);</span>
    <span class="n">mOriginalOrientation</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="no">PACKAGE_NAME</span> <span class="o">+</span> <span class="s">&quot;.orientation&quot;</span><span class="p">);</span>

    <span class="n">mBitmapDrawable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BitmapDrawable</span><span class="p">(</span><span class="n">getResources</span><span class="p">(),</span> <span class="n">bitmap</span><span class="p">);</span>
    <span class="n">mImageView</span><span class="p">.</span><span class="n">setImageDrawable</span><span class="p">(</span><span class="n">mBitmapDrawable</span><span class="p">);</span>

    <span class="n">ViewTreeObserver</span> <span class="n">observer</span> <span class="o">=</span> <span class="n">mImageView</span><span class="p">.</span><span class="n">getViewTreeObserver</span><span class="p">();</span>
        <span class="n">observer</span><span class="p">.</span><span class="n">addOnPreDrawListener</span><span class="p">(</span><span class="k">new</span> <span class="n">ViewTreeObserver</span><span class="p">.</span><span class="n">OnPreDrawListener</span><span class="p">()</span> <span class="p">{</span>

            <span class="p">@</span><span class="n">Override</span>
            <span class="n">public</span> <span class="n">boolean</span> <span class="n">onPreDraw</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">mImageView</span><span class="p">.</span><span class="n">getViewTreeObserver</span><span class="p">().</span><span class="n">removeOnPreDrawListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

                <span class="c1">// Figure out where the thumbnail and full size versions are, relative</span>
                <span class="c1">// to the screen and each other</span>
                <span class="k">int</span><span class="p">[]</span> <span class="n">screenLocation</span> <span class="o">=</span> <span class="k">new</span> <span class="k">int</span><span class="p">[</span><span class="mh">2</span><span class="p">];</span>
                <span class="n">mImageView</span><span class="p">.</span><span class="n">getLocationOnScreen</span><span class="p">(</span><span class="n">screenLocation</span><span class="p">);</span>
                <span class="n">mLeftDelta</span> <span class="o">=</span> <span class="n">thumbnailLeft</span> <span class="o">-</span> <span class="n">screenLocation</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span>
                <span class="n">mTopDelta</span> <span class="o">=</span> <span class="n">thumbnailTop</span> <span class="o">-</span> <span class="n">screenLocation</span><span class="p">[</span><span class="mh">1</span><span class="p">];</span>

                <span class="c1">// Scale factors to make the large version the same size as the thumbnail</span>
                <span class="n">mWidthScale</span> <span class="o">=</span> <span class="p">(</span><span class="n">float</span><span class="p">)</span> <span class="n">thumbnailWidth</span> <span class="o">/</span> <span class="n">mImageView</span><span class="p">.</span><span class="n">getWidth</span><span class="p">();</span>
                <span class="n">mHeightScale</span> <span class="o">=</span> <span class="p">(</span><span class="n">float</span><span class="p">)</span> <span class="n">thumbnailHeight</span> <span class="o">/</span> <span class="n">mImageView</span><span class="p">.</span><span class="n">getHeight</span><span class="p">();</span>

                <span class="n">runEnterAnimation</span><span class="p">();</span>

                <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">});</span>
</pre></div>


<p>ViewTreeObserver是View树监听类，可以监听View的一些变化。其中ViewTreeObserver.OnPreDrawListener内部类，是当视图要被绘制时会被回调的类。我们只要在创建一个ViewTreeObserver.OnPreDrawListener实例，传给ViewTreeObserver，就可以在View被绘制时回调onPreDraw方法，我们所要做的就是在这个方法中开始动画。这里注意在动画开始前已经把要显示的图片设置上去了。
runEnterAnimation方法：</p>
<div class="highlight"><pre><span class="c1">// Set starting values for properties we&#39;re going to animate. These</span>
    <span class="c1">// values scale and position the full size version down to the thumbnail</span>
    <span class="c1">// size/location, from which we&#39;ll animate it back up</span>
    <span class="n">mImageView</span><span class="p">.</span><span class="n">setPivotX</span><span class="p">(</span><span class="mh">0</span><span class="p">);</span>
    <span class="n">mImageView</span><span class="p">.</span><span class="n">setPivotY</span><span class="p">(</span><span class="mh">0</span><span class="p">);</span>
    <span class="n">mImageView</span><span class="p">.</span><span class="n">setScaleX</span><span class="p">(</span><span class="n">mWidthScale</span><span class="p">);</span>
    <span class="n">mImageView</span><span class="p">.</span><span class="n">setScaleY</span><span class="p">(</span><span class="n">mHeightScale</span><span class="p">);</span>
    <span class="n">mImageView</span><span class="p">.</span><span class="n">setTranslationX</span><span class="p">(</span><span class="n">mLeftDelta</span><span class="p">);</span>
    <span class="n">mImageView</span><span class="p">.</span><span class="n">setTranslationY</span><span class="p">(</span><span class="n">mTopDelta</span><span class="p">);</span>

    <span class="c1">// Animate scale and translation to go from thumbnail to full size</span>
    <span class="n">mImageView</span><span class="p">.</span><span class="n">animate</span><span class="p">().</span><span class="n">setDuration</span><span class="p">(</span><span class="n">duration</span><span class="p">).</span>
            <span class="n">scaleX</span><span class="p">(</span><span class="mh">1</span><span class="p">).</span><span class="n">scaleY</span><span class="p">(</span><span class="mh">1</span><span class="p">).</span>
            <span class="n">translationX</span><span class="p">(</span><span class="mh">0</span><span class="p">).</span><span class="n">translationY</span><span class="p">(</span><span class="mh">0</span><span class="p">).</span>
            <span class="n">setInterpolator</span><span class="p">(</span><span class="n">sDecelerator</span><span class="p">));</span>
</pre></div>


<p>这段代码先将ImageView从大图缩小到我们点击的那个缩略图的大小和位置，然后开始放大动画到它大图显示的样子。这样就实现了我们想要的点击缩略图放大到大图的效果。</p>
<blockquote>
<ul>
<li>关闭B Activity时，对ImageView做一个缩小的动画，初始位置就是它现在的位置，最终位置是最开始从Bundle中获取的那个位置。覆盖Activity的finish方法，同样要将Activity的默认动画覆盖掉overridePendingTransition(0, 0)</li>
</ul>
</blockquote>
<div class="highlight"><pre><span class="err">@</span><span class="n">Override</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">finish</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">super</span><span class="p">.</span><span class="n">finish</span><span class="p">();</span>

    <span class="c1">// override transitions to skip the standard window animations</span>
    <span class="n">overridePendingTransition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Overriding this method allows us to run our exit animation first, then exiting</span>
<span class="cm"> * the activity when it is complete.</span>
<span class="cm"> */</span>
<span class="err">@</span><span class="n">Override</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">onBackPressed</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">runExitAnimation</span><span class="p">(</span><span class="n">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">public</span> <span class="kt">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// *Now* go ahead and exit the activity</span>
            <span class="n">finish</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="n">private</span> <span class="kt">void</span> <span class="n">runExitAnimation</span><span class="p">(</span><span class="n">Runnable</span> <span class="n">endAction</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Animate image back to thumbnail size/location</span>
    <span class="n">mImageView</span><span class="p">.</span><span class="n">animate</span><span class="p">().</span><span class="n">setDuration</span><span class="p">(</span><span class="n">duration</span><span class="p">).</span>
               <span class="n">scaleX</span><span class="p">(</span><span class="n">mWidthScale</span><span class="p">).</span><span class="n">scaleY</span><span class="p">(</span><span class="n">mHeightScale</span><span class="p">).</span>
               <span class="n">translationX</span><span class="p">(</span><span class="n">mLeftDelta</span><span class="p">).</span><span class="n">translationY</span><span class="p">(</span><span class="n">mTopDelta</span><span class="p">).</span>
                            <span class="n">withEndAction</span><span class="p">(</span><span class="n">endAction</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>当用户关闭界面的时候，先执行ImageView的缩小动画，缩小到原来缩略图的位置。当动画结束后，finish掉Activity并覆盖掉默认的Activity动画。</p>
<p><strong>总结：第一步先要把Activity的theme变成透明。第覆盖掉Activity的启动或者关闭的默认动画效果。第三步如果要做进入动画，则可以实现ViewTreeObserver.OnPreDrawListener接口，在onPreDraw方法中做动画。如果是做退出动画，可以先对视图做动画，在动画结束的时候调用finish方法。</strong></p>
<p><a href="https://github.com/szuwest/ActivityAnimations">demo代码</a>.该demo是dev-bytes上的demo代码。</p>
<h2>扩展</h2>
<p>如果B要支持左右滑动查看大图，然后在查看某已图片时点击返回键，图片要缩小至该图缩略图的位置上，这该怎么做？
这种需求改变对A变化不大，但是对B的改变还是很大的，首先B要支持滑屏，一般来说要用到ViewPage或类似的控件。另外还有滑动时B如何获取数据，返回时如何获取当前大图对应的缩略图在A中的位置。我想实现方法应该有多种，我能想到的一种比较丑陋但是又比较简单的做法是，定义一个接口，声明了一些获取数据和缩略图位置等方法。然后A实现这个接口，传给B作为一个静态变量保存起来，这样A与B就可以通信了。这样只要B左右滑动的时候，A也保持一致的上下滑动，在B要关闭的时候，先获取到相应缩略图的问题，就能做动画了。</p><p class="subheader">Category: <a href="../category/misc.html">misc</a>

    Tagged: 
    <a href="../tag/android-ji-zhu-dong-hua.html">Android 技术 动画 </a>
</p>



<p><a href="../activitydong-hua-er.html#disqus_thread">comments</a></p>            </article>


                <hr  class="gradient"/>


        


            <article>
                <a href="../android-activitydong-hua.html"><h3 class="article-title">Android Activity动画</h3></a>
<h6 class="subheader" title="2014-11-03T00:00:00">2014-11-03
</h6>


<h1>Android 动画(一)</h1>
<h2>3.0之前的动画</h2>
<p>Android动画一直是Android的痛点。Android的动画系统跟iOS系统的动画系统比起来真心差很多，特别是2.3之前。在2.3之前，Android的动画分两种，帧动画和逐渐动画（Tween）.Tween动画包括alpha动画，translate动画，scale动画，rotate动画。这几种动画可以随意组合，产生更复杂的动画。但是我们想要做iOS的frame那样简单的动画，却是没有直接的方法。</p>
<hr />
<h2>3.0之后的动画</h2>
<p>在Android3.0版本，终于加入了更多的动画支持，API也更加友好。加入我property动画和value动画，大大增加了动画的灵活性和可定制性。可以通过ObjectAnimator很方便的写出动画代码。像iOS的frame动画，可以通过value动画来实现。还有因为property特性，可以实现一些特别的动画，并且不局限与view，理论上任何object都可以实现property动画。</p>
<h4>nineOldAnimation</h4>
<p>这个是向下兼容的Android动画库，使得在3.0之前的系统也可以实现property和value动画。不过这个库早已不维护了，我之前使用发现了一些bug，不过这影响不大。如果要兼容2.3和一下系统，这个是很不错的库。</p>
<h4>Android4.4和5.0 ...</h4><p class="subheader">Category: <a href="../category/ji-zhu.html">技术</a>

    Tagged: 
    <a href="../tag/android.html">Android </a>
</p>



<p><a href="../android-activitydong-hua.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="../android-activitydong-hua.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="../ji-zhu-she-jiao-sheng-huo.html"><h3 class="article-title">技术，社交，生活</h3></a>
<h6 class="subheader" title="2014-10-23T00:00:00">2014-10-23
</h6>


<h3>技术不能停</h3>
<hr />
<p>最近看了很多其他技术人员的文章，然后我又从iOS转战Android，感觉自己弱爆了，自己的技术跟那些厉害的人根本没得比。有句话说，知道得越多，知道自己不知道越多。现在自己还有冲进，应该尽力学多一点。</p>
<p>从计算机行业来说，技术千变万化，但是有些东西是基础性的。这些基本功决定你能走多远。算法，数据结构，编译原理，操作系统，这些基本的课程非常重要，而这又恰恰是我的弱项，我吃过这个亏。我想弥补。最近看微博看到<strong>陈皓</strong>这样的大牛把leetcode的题目刷完了，真是佩服不已。我之前我到上面刷过一下子，但是没有坚持下来。主要是有些还是挺难的，而且英语还是有点吃力。我决定先从基本功开始，进行一个系统的学习。虽然网络上又很多资料，但是网络上的资料都是不系统的，只能参考而已，不能作为学习材料。</p>
<p>所以我想从纸质书开始，我决定今后尽量少看任何社交软件，还有娱乐视频之类的，多一点时间看书。尽量调好作息时间，利用碎片化时间来学习。</p>
<h3>关于工作</h3>
<hr />
<p>我从开始做C++的SDK，后来加入iOS项目组做iOS开发，再到最近的支持Android开发，大半年时间就变化这么多。项目也都是做到了一半就被停掉。XL公司的基因就是这样 ...</p><p class="subheader">Category: <a href="../category/za-tan.html">杂谈</a>

    Tagged: 
    <a href="../tag/za-tan.html">杂谈 </a>
</p>



<p><a href="../ji-zhu-she-jiao-sheng-huo.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="../ji-zhu-she-jiao-sheng-huo.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="../good-morning.html"><h3 class="article-title">Good Morning</h3></a>
<h6 class="subheader" title="2014-10-15T00:00:00">2014-10-15
</h6>


<p>Hi, good morning. This is from West.</p><p class="subheader">Category: <a href="../category/test.html">Test</a>

    Tagged: 
    <a href="../tag/test.html">Test </a>
</p>



<p><a href="../good-morning.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="../good-morning.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="../guan-yu-cheng-xu-jia-gou-she-ji.html"><h3 class="article-title">关于程序架构设计</h3></a>
<h6 class="subheader" title="2014-06-22T00:00:00">2014-06-22
</h6>


<h1>关于程序架构设计</h1>
<p>最近编程当中，越来越在意程序架构问题，经常纠结怎样才是好的设计，怎样才能将程序解耦，怎样才能写出易扩展，层次分明好维护的程序。可是想来想去也是不能决定怎样做才是最佳。不过最近自己是肯定了一样东西：要想真的做出好的架构，划分好模块是第一次。只要模块划分的清晰，独立和少耦合，后面的事情就好做了。</p>
<p>这种想法也不单单只有我才有，我现在所在项目负责人在一个程序架构设计的技术讲座上说过这个观点。而我从我们项目的架构也看出他是这样实行的。一般在我们建立项目之初，就先建立好目录结构，而这个目录结构也很讲究，它就直接体现了我们是怎么划分模块和划分层次的。现在我们项目主要分两大块，UI模块和module模块。然后UI目录下就按照功能划分出一个个子目录，对应的再module目录下也是按照功能划分出一个个子目录。这里UI目录下的子目录结构和module目录下的子目录结构基本是一致的。然后在资源文件目录下，也是按照UI子模块那样划分，建立不同的子资源文件。只要划分好了模块，每个模块足够独立的花，每个模块里面是怎么分层，怎么做设计的，对别的模块影响不大。即使这个某个模块做得很烂，到时要重构的也只是那一个模块而已。</p>
<p>现在我们公司的项目很多模块划分都不是特别好，能够做到像上面那样划分模块和架构的项目估计都是很多。互联网公司人员流动大，三两下就换一拨人，每拨人里面各个技术参差不齐，根本没办法做到很好的架构设计。但是上面这种基础的架构还是可以做的，而且是可以做好的。</p>
<p>可是光是靠划分模块是做不到一个好的程序架构，而且一个项目有些模块是划分不出来或者跟其他模块联系很多。所以还有其他东西要做。分层就是一个。项目整体可以分层，还有模块里面也可以分层 ...</p><p class="subheader">Category: <a href="../category/bian-cheng-jia-gou.html">编程 架构</a>

    Tagged: 
    <a href="../tag/bian-cheng-gan-wu.html">编程感悟 </a>
</p>



<p><a href="../guan-yu-cheng-xu-jia-gou-she-ji.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="../guan-yu-cheng-xu-jia-gou-she-ji.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="../swiftchu-tan.html"><h3 class="article-title">swift初探</h3></a>
<h6 class="subheader" title="2014-06-22T00:00:00">2014-06-22
</h6>


<h1>swift初探</h1>
<p>自从swift公布以来，火得不得了。如果你是开发者，还没有看过swift，那还真是out了（不过话说回来，并不是没有看过swift就不是好开发者。好的程序员跟看没看过某种语言没有什么关系）。我从公布以来就断断续续的看，一直在看官方的英文文档。偶尔也看看别人写的或者翻译的文章。现在虽然没有把官方文档看完，但是也看了大部分，可以写写感想心得。</p>
<p>简单来说，swift是集合了许多脚本语言的特性而又不像其他一般的脚本语言的苹果新生代开发语言。swift集合了很多语言的特性，如ruby，object-c，c++，c#等，其中长得最像的应该是ruby。咋看之下swift就想ruby一样的脚本语言。完全面向对象，类型定义，closure特性，函数式编程等等。不过据官方文档介绍，swift语言不是解释型语言，它最终会编译成二进制代码，并且它的运行效率比object-c要快。说比object-C要快我是比较怀疑的，而外国开发者进行了测试，得出结论是如果不强加一些编译优化的话，是快不过objC的。</p>
<p>如果对ruby，Object-C，c++语言熟悉的话，学起swift来应该没有什么难度。但是它还有很多语法特性是别的语言没有的，并且有些在我看来有点奇怪的特性。不过这是都没有什么，说明自己见识少，熟悉了就好了。首先一个比较特别的是，你不在需要在每行代码结束时加上分号，直接回车换行就行 ...</p><p class="subheader">Category: <a href="../category/bian-cheng-yu-yan.html">编程语言</a>

    Tagged: 
    <a href="../tag/swift.html">swift </a>
</p>



<p><a href="../swiftchu-tan.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="../swiftchu-tan.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="../hello-world.html"><h3 class="article-title">Hello world</h3></a>
<h6 class="subheader" title="2014-06-10T00:00:00">2014-06-10
</h6>


<h1>Hello World</h1>
<p>Hello, world. This is first test.</p><p class="subheader">Category: <a href="../category/test.html">Test</a>

    Tagged: 
    <a href="../tag/test.html">Test </a>
</p>



<p><a href="../hello-world.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="../hello-world.html">Read More</a>
                <hr  class="gradient"/>
            </article>

            <!-- /#posts-list -->
<div class="pagination-centered">
<h6 class="subheader">Page 1 of 1</h6>

<p>

</p>
</div>

    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="../archives.html">Archives</a>
            <li><a href="../tags.html">Tags</a>


        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="../category/bian-cheng-jia-gou.html">编程 架构</a></li>
            <li><a href="../category/bian-cheng-yu-yan.html">编程语言</a></li>
            <li><a href="../category/ji-zhu.html">技术</a></li>
            <li><a href="../category/misc.html">misc</a></li>
            <li><a href="../category/test.html">Test</a></li>
            <li><a href="../category/za-tan.html">杂谈</a></li>
   
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://getpelican.com/">Pelican</a></li>
            <li><a href="http://szhanfeng203.blog.163.com/">我的生活博客</a></li>
        </ul>
		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/szuwest">Github</a></li>
            <li><a href="https://twitter.com/szuwest">Twitter</a></li>
            <li><a href="https://www.facebook.com/profile.php?id=1084651913">Facebook</a></li>
            <li><a href="http://weibo.com/szuwest">微博</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>West's blog by West</p>
            </div>
            </div>
    </div>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-55687145-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</footer>